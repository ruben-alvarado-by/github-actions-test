name: CI
on: [push]
jobs:
  # test:
  #   ...
  deploy:
    name: "Deploy to VM"
    runs-on: ubuntu-latest
    # if: github.event_name == 'push' && github.ref == 'refs/heads/master'

    steps:
      # - name: Azure Login
      #   uses: azure/login@v1
      #   with:
      #     creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Configure SSH
        run: |
          mkdir -p ~/.ssh/
          echo "$SSH_KEY" > ~/.ssh/prometheusvm.key
          chmod 600 ~/.ssh/prometheusvm.key
          cat >>~/.ssh/config <<END
          Host prometheusvm
            HostName $SSH_HOST
            User $SSH_USER
            IdentityFile ~/.ssh/prometheusvm.key
            StrictHostKeyChecking no
          END
        env:
          SSH_USER: ${{ secrets.SSH_USER }}
          SSH_KEY: ${{ secrets.SSH_KEY }}
          SSH_HOST: ${{ secrets.SSH_HOST }}

      - name: Stop the server
        run: ssh prometheusvm 'echo hola'

      # - name: Check out the source
      #   run: ssh prometheusvm 'cd my-application && git fetch && git reset --hard origin/master'

      # - name: Start the server
      #   if: ${{ always() }}
      #   run: ssh prometheusvm 'sudo systemctl start my-application'
# name: Actions Workflow
# on: 
#   # schedule:
#   #   - cron: "0/5 * * * *"
#   #   - cron: "0/6 * * * *"
#   #push:
#   repository_dispatch:
#     types: 
#       - build
#   pull_request:
#     types:
#       - closed
#       - assigned
#       - opened
#       - reopened
# jobs:
#   run-github-Actions:
#     runs-on: ubuntu-latest
#     steps:
#       - name: payload
#         run: echo ${{ github.event.client_payload.env}}
#       - name: List Files
#         run: |
#           pwd 
#           echo "--------------"
#           ls -a
#           echo $GITHUB_SHA
#           echo $GITHUB_REPOSITORY
#           echo $GITHUB_WORKSPACE 
#           echo "${{ github.token }}"
#           # git clone git@github:$GITHUB_REPOSITORY
#           # git checkout $GITHUB_SHA
#       - name: Checkout
#         uses: actions/checkout@v1
#       - name: List Files after checkout
#         run: |
#           pwd 
#           echo "--------------"
#           ls -a
#       - name: simple JS Actions
#         id: greet
#         uses: actions/hello-world-javascript-action@v1
#         with:
#           who-to-greet: Rubencito
#       - name: Log greeting time xxx
#         run: echo "${{ steps.greet.outputs.time }}" 